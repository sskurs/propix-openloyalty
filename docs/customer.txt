Customer Web (Next.js)
        |
        v
Customer API  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚
Admin Web (Next.js)          â”‚
        |                    â”‚
        v                    â”‚
Admin API  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
                       â”‚     â”‚
                       v     v
                   PostgreSQL / Redis
                       â–²
                       |
                Loyalty Worker
                       |
                    Kafka

ğŸ” Who Talks to Whom (Summary Table)

| Component      | Talks to Kafka?   | Talks to DB? | Talks to API?  |
| -------------- | ----------------- | ------------ | -------------- |
| Admin Web      | âŒ No              | âŒ No         | âœ… Admin API    |
| Customer Web   | âŒ No              | âŒ No         | âœ… Customer API |
| Admin API      | âŒ (produces only) | âœ… Yes        | âŒ              |
| Customer API   | âŒ                 | âœ… Yes        | âŒ              |
| Loyalty Worker | âœ… Yes             | âœ… Yes        | âŒ              |


ğŸŸ¢ 1ï¸âƒ£ How Customer Web Gets Data

GET /api/customer/profile
GET /api/customer/points/balance
GET /api/customer/transactions
GET /api/customer/rewards
GET /api/customer/redemptions

Customer Web
   |
   | GET /api/customer/points
   v
Customer API
   |
   | SELECT points FROM DB
   v
Response JSON

Customer Earns Points (End-to-End)
Step 1 â€” Transaction happens
Customer Web â†’ POST /api/customer/transaction

Step 2 â€” Customer API

Saves transaction

Publishes event:

topic: transaction.recorded

Step 3 â€” Loyalty Worker

Consumes event

Applies earning rules

Calculates points

Updates DB

Writes Outbox event

Step 4 â€” UI reads updated data
Customer Web â†’ GET /api/customer/points

ğŸŸ£ 5ï¸âƒ£ Redemption Flow
Customer Web
   |
POST /api/customer/redeem
   |
Customer API
   |
Publish: reward.redeemed
   |
Loyalty Worker
   |
Validate points
   |
Deduct points
   |
Update DB
   |
Emit: redemption.completed